import fs from 'fs';

const filePath = './personalize.json';
const defaultData = {
    botName: "Alya Mikhailovna Kujou",
    currency: "yen",
    videos: [
        'https://qu.ax/WgJR.mp4',
        'https://qu.ax/kOwY.mp4',
        'https://qu.ax/UYGf.mp4'
    ]
};

let handler = async (m, { conn }) => {
    try {
        // Verificar si el archivo de personalizaciÃ³n existe, si no, crearlo
        if (!fs.existsSync(filePath)) {
            const initialData = { default: defaultData, users: {} };
            fs.writeFileSync(filePath, JSON.stringify(initialData, null, 2));
        }

        // Leer la configuraciÃ³n del archivo
        const config = JSON.parse(fs.readFileSync(filePath));

        // Obtener las configuraciones personalizadas del usuario, o usar las predeterminadas
        const userConfig = config.users[m.sender] || config.default;

        // Seleccionar un video aleatoriamente
        const randomVideoUrl = userConfig.videos[Math.floor(Math.random() * userConfig.videos.length)];

        // Texto del mensaje del menÃº con personalizaciÃ³n o datos predeterminados
        const menuMessage = `
â”â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆà­¨ ï¼©ï½ï½†ï½ à­§â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”’


   âœ¦ Desarrollado por: ğ“”ğ“¶ğ“¶ğ“ª (ğ“¥ğ“²ğ“¸ğ“µğ“®ğ“½'ğ“¼ ğ“¥ğ“®ğ“»ğ“¼ğ“²ğ“¸ğ“·)
   âœ¦ VersiÃ³n actual: ${vs}
â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆà­¨â™¡à­§â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ
   *Hola!* soy ${userConfig.botName} aqui tenes la lista de comandos
   âœ¦ *La Moneda actual es :* ${userConfig.currency}
â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆà­¨â™¡à­§â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ
   > Perzonalizacion

   .setname 
   .setbanner
   .setmoneda
   .viewbanner
   .deletebanner
   .resetpreferences
â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆà­¨â™¡à­§â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ
   > Random

   .rw .rollwaifu
   .c .claim
   .harem
â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆà­¨â™¡à­§â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ
> Descargas

.play _nombre de la cancion_ (audio)
.play2 _nombre de la cancion_ (video)

â”–â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆà­¨â™¡à­§â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”š`;

        // Enviar el video aleatorio como GIF
        await conn.sendMessage(
            m.chat,
            {
                video: { url: randomVideoUrl },
                gifPlayback: true,
                caption: menuMessage,
                mentions: [m.sender]
            }
        );
    } catch (error) {
        conn.reply(m.chat, `âŒ Error al cargar el menÃº: ${error.message}`, m);
    }
};

handler.help = ['menu'];
handler.tags = ['info'];
handler.command = /^(menu)$/i;

export default handler;
